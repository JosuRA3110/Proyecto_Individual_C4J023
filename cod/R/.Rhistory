pivot_longer(
cols = -Estado,
names_to = "Año",
values_to = "Obesidad"
) %>%
left_join(estados, by = c("Estado" = "Nombre")) %>%
mutate(Estado = Abrev) %>%
select(-Abrev)
Obesidad.limpia <- Obesidad.limpia %>%
mutate(Año = as.integer(Año)) %>%
filter(Año >= "2014", Año <= "2022")
#Imputamos los datos por interpolaridad lineal
Obesidad.limpia <- Obesidad.limpia %>%
group_by(Estado) %>%
arrange(Año) %>%
mutate(Obesidad = zoo::na.approx(Obesidad, na.rm = FALSE))
#Ahora como ya imputamos los datos, solo quiero ordenar un poco la base de datos de la tasa de mortalidad cardiovascular tq
Cardiovascular.limpia <- Cardiovascular %>%
arrange(STATE, YEAR) %>%
filter(YEAR != 2023)
Cardiovascular.limpia <- Cardiovascular.limpia %>% #Aca intente poner todo en el español y quitar los datos innecesarios
rename(
Estado = STATE,
Año = YEAR,
Mortalidad_cardiovascular = RATE
) %>%
select(-DEATHS, -URL) %>%
mutate(Año = as.integer(Año))
Base.graficos <- Obesidad.limpia %>%
left_join(Cardiovascular.limpia, by = c("Estado", "Año"))
#Ahora para tenerlo disponible mas adelante guardaremos cada año a utilizar en la interfaz dinamica que crearemos mas adelante
anios <- 2014:2022
for (a in anios) {
base.anios <- Base.graficos %>%
filter(Año == a)
#Ahora guardamos las bases "limpias" en la data que serian las que verdaderamente utilicemos para graficar en el mapa interactivo
write.csv(
base.anios,
here("data", paste0("Base.", a, ".csv")),
row.names = FALSE
)
}
#Guardamos el resto de bases en data
write.csv(Obesidad.limpia, here("data", "Obesidad.limpia.csv"), row.names = FALSE)
write.csv(Cardiovascular.limpia, here("data", "Cardiovascular.limpia.csv"), row.names = FALSE)
View(Obesidad.limpia)
View(Cardiovascular.limpia)
summary(Base.graficos)
table(is.na(Base.graficos$Obesidad))
table(is.na(Base.graficos$Mortalidad_cardiovascular))
summary(Base.graficos)
table(is.na(Base.graficos$Obesidad.limpia))
table(is.na(Base.graficos$Mortalidad_cardiovascular.limpia))
write.csv(Base.graficos, here("data", "Base.graficos.csv"), row.names = FALSE)
#Para este caso nada más aclaro que el excel de obesidad lo recopiole a partir de un informe con base en los datos del Trust for America's Health analysis of CDC's Behavioral Risk Factor Surveillance System data
#Con ello claro procedemos a cargar las librerias necesarias para el proyecto
library(here)
library(dplyr)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
#Ahora cargamos los datos adecuadamente:
Obesidad <- read_excel(here("data_raw", "Obesidad_2011-2022.xlsx"))
#Esta base de datos que cargaremos se basa sobre la
Cardiovascular <- read.csv(here("data_raw", "Mortalidad_cardiovascular_2014-2023.csv"))
#Ahora veamos cada base por separado para ver si poseen NAs
sum(is.na(Obesidad))
sum(is.na(Cardiovascular))
#Vea que solo tenemos NAs en la base de datos sobre la obesidad, para imputar dichos datos procedemos por interpolacion lineal tq este método estima los valores faltantes manteniendo la tendencia natural entre los años alrededor, lo cual es adecuado debido a la estabilidad interanual característica de las prevalencias de obesidad en los estados unidos.
estados <- tibble( #Aca creamos una tabla con el listado de las abreviaturas de los estados de USA que vienen integrados en R
Nombre = state.name,
Abrev = state.abb
)
Obesidad.limpia <- Obesidad %>%
rename(Estado = 1) %>%
pivot_longer(
cols = -Estado,
names_to = "Año",
values_to = "Obesidad"
) %>%
left_join(estados, by = c("Estado" = "Nombre")) %>%
mutate(Estado = Abrev) %>%
select(-Abrev)
Obesidad.limpia <- Obesidad.limpia %>%
mutate(Año = as.integer(Año)) %>%
filter(Año >= "2014", Año <= "2022")
#Imputamos los datos por interpolaridad lineal
Obesidad.limpia <- Obesidad.limpia %>%
group_by(Estado) %>%
arrange(Año) %>%
mutate(Obesidad = zoo::na.approx(Obesidad, na.rm = FALSE))
#Ahora como ya imputamos los datos, solo quiero ordenar un poco la base de datos de la tasa de mortalidad cardiovascular tq
Cardiovascular.limpia <- Cardiovascular %>%
arrange(STATE, YEAR) %>%
filter(YEAR != 2023)
Cardiovascular.limpia <- Cardiovascular.limpia %>% #Aca intente poner todo en el español y quitar los datos innecesarios
rename(
Estado = STATE,
Año = YEAR,
Mortalidad_cardiovascular = RATE
) %>%
select(-DEATHS, -URL) %>%
mutate(Año = as.integer(Año))
Base.graficos <- Obesidad.limpia %>%
left_join(Cardiovascular.limpia, by = c("Estado", "Año"))
#Ahora para tenerlo disponible mas adelante guardaremos cada año a utilizar en la interfaz dinamica que crearemos mas adelante
anios <- 2014:2022
for (a in anios) {
base.anios <- Base.graficos %>%
filter(Año == a)
#Ahora guardamos las bases "limpias" en la data que serian las que verdaderamente utilicemos para graficar en el mapa interactivo
write.csv(
base.anios,
here("data", paste0("Base.", a, ".csv")),
row.names = FALSE
)
}
#Guardamos el resto de bases en data
write.csv(Obesidad.limpia, here("data", "Obesidad.limpia.csv"), row.names = FALSE)
write.csv(Cardiovascular.limpia, here("data", "Cardiovascular.limpia.csv"), row.names = FALSE)
write.csv(Base.graficos, here("data", "Base.graficos.csv"), row.names = FALSE)
summary(Base.graficos)
table(is.na(Base.graficos$Obesidad.limpia))
table(is.na(Base.graficos$Mortalidad_cardiovascular.limpia))
#Ahora procedemos a crear los diveros graficos y la interfaz grafica con la que interactua el usuario
install.packages("shiny")
install.packages("geojsonio")
install.packages("leaflet")
#Para este caso nada más aclaro que el excel de obesidad lo recopiole a partir de un informe con base en los datos del Trust for America's Health analysis of CDC's Behavioral Risk Factor Surveillance System data
#Con ello claro procedemos a cargar las librerias necesarias para el proyecto
library(here)
library(dplyr)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(leaflet)
library(geojsonio)
library(shiny)
#Ahora cargamos los datos adecuadamente:
Obesidad <- read_excel(here("data_raw", "Obesidad_2011-2022.xlsx"))
#Esta base de datos que cargaremos se basa sobre la
Cardiovascular <- read.csv(here("data_raw", "Mortalidad_cardiovascular_2014-2023.csv"))
#Ahora veamos cada base por separado para ver si poseen NAs
sum(is.na(Obesidad))
sum(is.na(Cardiovascular))
#Vea que solo tenemos NAs en la base de datos sobre la obesidad, para imputar dichos datos procedemos por interpolacion lineal tq este método estima los valores faltantes manteniendo la tendencia natural entre los años alrededor, lo cual es adecuado debido a la estabilidad interanual característica de las prevalencias de obesidad en los estados unidos.
estados <- tibble( #Aca creamos una tabla con el listado de las abreviaturas de los estados de USA que vienen integrados en R
Nombre = state.name,
Abrev = state.abb
)
Obesidad.limpia <- Obesidad %>%
rename(Estado = 1) %>%
pivot_longer(
cols = -Estado,
names_to = "Año",
values_to = "Obesidad"
) %>%
left_join(estados, by = c("Estado" = "Nombre")) %>%
mutate(Estado = Abrev) %>%
select(-Abrev)
Obesidad.limpia <- Obesidad.limpia %>%
mutate(Año = as.integer(Año)) %>%
filter(Año >= "2014", Año <= "2022")
#Imputamos los datos por interpolaridad lineal
Obesidad.limpia <- Obesidad.limpia %>%
group_by(Estado) %>%
arrange(Año) %>%
mutate(Obesidad = zoo::na.approx(Obesidad, na.rm = FALSE))
#Ahora como ya imputamos los datos, solo quiero ordenar un poco la base de datos de la tasa de mortalidad cardiovascular tq
Cardiovascular.limpia <- Cardiovascular %>%
arrange(STATE, YEAR) %>%
filter(YEAR != 2023)
Cardiovascular.limpia <- Cardiovascular.limpia %>% #Aca intente poner todo en el español y quitar los datos innecesarios
rename(
Estado = STATE,
Año = YEAR,
Mortalidad_cardiovascular = RATE
) %>%
select(-DEATHS, -URL) %>%
mutate(Año = as.integer(Año))
Base.graficos <- Obesidad.limpia %>%
left_join(Cardiovascular.limpia, by = c("Estado", "Año"))
#Ahora para tenerlo disponible mas adelante guardaremos cada año a utilizar en la interfaz dinamica que crearemos mas adelante
anios <- 2014:2022
for (a in anios) {
base.anios <- Base.graficos %>%
filter(Año == a)
#Ahora guardamos las bases "limpias" en la data que serian las que verdaderamente utilicemos para graficar en el mapa interactivo
write.csv(
base.anios,
here("data", paste0("Base.", a, ".csv")),
row.names = FALSE
)
}
#Guardamos el resto de bases en data
write.csv(Obesidad.limpia, here("data", "Obesidad.limpia.csv"), row.names = FALSE)
write.csv(Cardiovascular.limpia, here("data", "Cardiovascular.limpia.csv"), row.names = FALSE)
write.csv(Base.graficos, here("data", "Base.graficos.csv"), row.names = FALSE)
#Ahora procedemos a crear los diveros graficos y la interfaz grafica con la que interactua el usuario
#Primero creamos el mapa
ui <- fluidPage(
titlePanel("Mapa de Obesidad en Estados Unidos"),
leafletOutput("mapa", height = "600px")
)
server <- function(input, output, session) {
# Cargar un año fijo (2014)
datos_2014 <- read_csv(here("data", "Base.2014.csv"))
# Cargar geojson de estados
estados_geo <- geojsonio::geojson_read(
"https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json",
what = "sp"
)
# Emparejar abreviaturas
estados_geo@data <- estados_geo@data %>%
mutate(Estado = abbrev) %>%
left_join(datos_2014, by = "Estado")
# Mapa
output$mapa <- renderLeaflet({
leaflet(estados_geo) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~colorNumeric("YlOrRd", Obesidad)(Obesidad),
weight = 1,
color = "#444444",
fillOpacity = 0.8,
highlight = highlightOptions(weight = 2, color = "black", bringToFront = TRUE),
label = ~paste0(NAME, ": ", round(Obesidad, 1), "% de obesidad")
)
})
}
# Iniciar App Shiny
shinyApp(ui, server)
#Para este caso nada más aclaro que el excel de obesidad lo recopiole a partir de un informe con base en los datos del Trust for America's Health analysis of CDC's Behavioral Risk Factor Surveillance System data
#Con ello claro procedemos a cargar las librerias necesarias para el proyecto
library(here)
library(dplyr)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(leaflet)
library(geojsonio)
library(shiny)
#Ahora cargamos los datos adecuadamente:
Obesidad <- read_excel(here("data_raw", "Obesidad_2011-2022.xlsx"))
#Esta base de datos que cargaremos se basa sobre la
Cardiovascular <- read.csv(here("data_raw", "Mortalidad_cardiovascular_2014-2023.csv"))
#Ahora veamos cada base por separado para ver si poseen NAs
sum(is.na(Obesidad))
sum(is.na(Cardiovascular))
#Vea que solo tenemos NAs en la base de datos sobre la obesidad, para imputar dichos datos procedemos por interpolacion lineal tq este método estima los valores faltantes manteniendo la tendencia natural entre los años alrededor, lo cual es adecuado debido a la estabilidad interanual característica de las prevalencias de obesidad en los estados unidos.
estados <- tibble( #Aca creamos una tabla con el listado de las abreviaturas de los estados de USA que vienen integrados en R
Nombre = state.name,
Abrev = state.abb
)
Obesidad.limpia <- Obesidad %>%
rename(Estado = 1) %>%
pivot_longer(
cols = -Estado,
names_to = "Año",
values_to = "Obesidad"
) %>%
left_join(estados, by = c("Estado" = "Nombre")) %>%
mutate(Estado = Abrev) %>%
select(-Abrev)
Obesidad.limpia <- Obesidad.limpia %>%
mutate(Año = as.integer(Año)) %>%
filter(Año >= "2014", Año <= "2022")
#Imputamos los datos por interpolaridad lineal
Obesidad.limpia <- Obesidad.limpia %>%
group_by(Estado) %>%
arrange(Año) %>%
mutate(Obesidad = zoo::na.approx(Obesidad, na.rm = FALSE))
#Ahora como ya imputamos los datos, solo quiero ordenar un poco la base de datos de la tasa de mortalidad cardiovascular tq
Cardiovascular.limpia <- Cardiovascular %>%
arrange(STATE, YEAR) %>%
filter(YEAR != 2023)
Cardiovascular.limpia <- Cardiovascular.limpia %>% #Aca intente poner todo en el español y quitar los datos innecesarios
rename(
Estado = STATE,
Año = YEAR,
Mortalidad_cardiovascular = RATE
) %>%
select(-DEATHS, -URL) %>%
mutate(Año = as.integer(Año))
Base.graficos <- Obesidad.limpia %>%
left_join(Cardiovascular.limpia, by = c("Estado", "Año"))
#Ahora para tenerlo disponible mas adelante guardaremos cada año a utilizar en la interfaz dinamica que crearemos mas adelante
anios <- 2014:2022
for (a in anios) {
base.anios <- Base.graficos %>%
filter(Año == a)
#Ahora guardamos las bases "limpias" en la data que serian las que verdaderamente utilicemos para graficar en el mapa interactivo
write.csv(
base.anios,
here("data", paste0("Base.", a, ".csv")),
row.names = FALSE
)
}
#Guardamos el resto de bases en data
write.csv(Obesidad.limpia, here("data", "Obesidad.limpia.csv"), row.names = FALSE)
write.csv(Cardiovascular.limpia, here("data", "Cardiovascular.limpia.csv"), row.names = FALSE)
write.csv(Base.graficos, here("data", "Base.graficos.csv"), row.names = FALSE)
#Ahora procedemos a crear los diveros graficos y la interfaz grafica con la que interactua el usuario
#Primero creamos el mapa
ui <- fluidPage(
titlePanel("Mapa de Obesidad y mortalidad en Estados Unidos"),
leafletOutput("mapa", height = "1800px")
)
server <- function(input, output, session) {
# Cargar un año fijo (2014)
Base.2014 <- read_csv(here("data", "Base.2014.csv"))
# Cargar geojson de estados
estados.mapa <- geojsonio::geojson_read(
"https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json",
what = "sp"
)
# Emparejar abreviaturas
estados.mapa@data <- estados.mapa@data %>%
mutate(Estado = abbrev) %>%
left_join(Base.2014, by = "Estado")
# Mapa
output$mapa <- renderLeaflet({
leaflet(estados.mapa) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~colorNumeric("YlOrRd", Obesidad)(Obesidad),
weight = 1,
color = "blue",
fillOpacity = 0.8,
highlight = highlightOptions(weight = 2, color = "black", bringToFront = TRUE),
label = ~paste0(NAME, ": ", round(Obesidad, 1), "% de obesidad")
)
})
}
# Iniciar App Shiny
shinyApp(ui, server)
estados.mapa <- geojsonio::geojson_read(
"https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json",
what = "sp"
)
names(estados.mapa@data)
View(estados.mapa)
install.packages("maps")
#Para este caso nada más aclaro que el excel de obesidad lo recopiole a partir de un informe con base en los datos del Trust for America's Health analysis of CDC's Behavioral Risk Factor Surveillance System data
#Con ello claro procedemos a cargar las librerias necesarias para el proyecto
library(here)
library(dplyr)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(leaflet)
library(ggplot2)
library(shiny)
library(maps)
#Ahora cargamos los datos adecuadamente:
Obesidad <- read_excel(here("data_raw", "Obesidad_2011-2022.xlsx"))
#Esta base de datos que cargaremos se basa sobre la
Cardiovascular <- read.csv(here("data_raw", "Mortalidad_cardiovascular_2014-2023.csv"))
#Ahora veamos cada base por separado para ver si poseen NAs
sum(is.na(Obesidad))
sum(is.na(Cardiovascular))
#Vea que solo tenemos NAs en la base de datos sobre la obesidad, para imputar dichos datos procedemos por interpolacion lineal tq este método estima los valores faltantes manteniendo la tendencia natural entre los años alrededor, lo cual es adecuado debido a la estabilidad interanual característica de las prevalencias de obesidad en los estados unidos.
estados <- tibble( #Aca creamos una tabla con el listado de las abreviaturas de los estados de USA que vienen integrados en R
Nombre = state.name,
Abrev = state.abb
)
Obesidad.limpia <- Obesidad %>%
rename(Estado = 1) %>%
pivot_longer(
cols = -Estado,
names_to = "Año",
values_to = "Obesidad"
) %>%
left_join(estados, by = c("Estado" = "Nombre")) %>%
mutate(Estado = Abrev) %>%
select(-Abrev)
Obesidad.limpia <- Obesidad.limpia %>%
mutate(Año = as.integer(Año)) %>%
filter(Año >= "2014", Año <= "2022")
#Imputamos los datos por interpolaridad lineal
Obesidad.limpia <- Obesidad.limpia %>%
group_by(Estado) %>%
arrange(Año) %>%
mutate(Obesidad = zoo::na.approx(Obesidad, na.rm = FALSE))
#Ahora como ya imputamos los datos, solo quiero ordenar un poco la base de datos de la tasa de mortalidad cardiovascular tq
Cardiovascular.limpia <- Cardiovascular %>%
arrange(STATE, YEAR) %>%
filter(YEAR != 2023)
Cardiovascular.limpia <- Cardiovascular.limpia %>% #Aca intente poner todo en el español y quitar los datos innecesarios
rename(
Estado = STATE,
Año = YEAR,
Mortalidad_cardiovascular = RATE
) %>%
select(-DEATHS, -URL) %>%
mutate(Año = as.integer(Año))
Base.graficos <- Obesidad.limpia %>%
left_join(Cardiovascular.limpia, by = c("Estado", "Año"))
#Ahora para tenerlo disponible mas adelante guardaremos cada año a utilizar en la interfaz dinamica que crearemos mas adelante
anios <- 2014:2022
for (a in anios) {
base.anios <- Base.graficos %>%
filter(Año == a)
#Ahora guardamos las bases "limpias" en la data que serian las que verdaderamente utilicemos para graficar en el mapa interactivo
write.csv(
base.anios,
here("data", paste0("Base.", a, ".csv")),
row.names = FALSE
)
}
#Guardamos el resto de bases en data
write.csv(Obesidad.limpia, here("data", "Obesidad.limpia.csv"), row.names = FALSE)
write.csv(Cardiovascular.limpia, here("data", "Cardiovascular.limpia.csv"), row.names = FALSE)
write.csv(Base.graficos, here("data", "Base.graficos.csv"), row.names = FALSE)
#Ahora procedemos a crear los diveros graficos y la interfaz grafica con la que interactua el usuario
#Primero creamos el mapa
# ---- 1) CARGAR BASES ----
Base.graficos <- Base.graficos %>%
mutate(region = tolower(Estado))   # para hacer match después
# ---- 2) CARGAR MAPA DE ESTADOS ----
estados_mapa <- map_data("state")    # viene de ggplot2
# tabla para convertir nombre → abreviatura
estados_tabla <- tibble(
region = tolower(state.name),
Estado = state.abb
)
# unir mapa con abreviaturas
estados_mapa <- estados_mapa %>%
left_join(estados_tabla, by = "region")
# ---- 3) INTERFAZ ----
ui <- fluidPage(
titlePanel("Obesidad y Mortalidad Cardiovascular en EE.UU. (2014-2022)"),
sidebarLayout(
sidebarPanel(
sliderInput(
"anio",
"Selecciona el año:",
min = 2014, max = 2022,
value = 2014,
sep = ""
),
h4("Estado seleccionado:"),
textOutput("estado_click")
),
mainPanel(
leafletOutput("mapa", height = 600),
hr(),
plotOutput("grafico")
)
)
)
# ---- 4) SERVIDOR ----
server <- function(input, output, session) {
# --- 4.1 Mapa dinámico por año ---
mapa_reactivo <- reactive({
datos_anio <- Base.graficos %>% filter(Año == input$anio)
estados_join <- estados_mapa %>%
left_join(datos_anio, by = "Estado")
estados_join
})
# --- 4.2 Render Leaflet ---
output$mapa <- renderLeaflet({
leaflet() %>%
addProviderTiles("CartoDB.Positron") %>%
setView(-98.5, 39.8, zoom = 4)
})
# --- 4.3 Actualizar polígonos según slider ---
observe({
df <- mapa_reactivo()
pal <- colorNumeric("Reds", df$Obesidad, na.color = "gray80")
leafletProxy("mapa", data = df) %>%
clearShapes() %>%
addPolygons(
lng = ~long,
lat = ~lat,
group = ~group,
fillColor = ~pal(Obesidad),
fillOpacity = 0.7,
color = "white",
weight = 1,
layerId = ~Estado,    # NECESARIO PARA CLICKS
label = ~paste0(Estado, ": ", round(Obesidad, 1), "%")
)
})
# --- 4.4 Mostrar el estado que se clickeó ---
output$estado_click <- renderText({
click <- input$mapa_shape_click
if (is.null(click$id)) "Ninguno"
else click$id
})
# --- 4.5 Render gráfico al hacer click ---
output$grafico <- renderPlot({
click <- input$mapa_shape_click
if (is.null(click$id)) return(NULL)
df_estado <- Base.graficos %>% filter(Estado == click$id)
ggplot(df_estado, aes(x = Obesidad, y = Mortalidad_cardiovascular)) +
geom_point(size = 3, color = "blue") +
geom_smooth(method = "lm", se = FALSE, color = "black") +
labs(
title = paste("Obesidad vs Mortalidad Cardiovascular |", click$id),
x = "Obesidad (%)",
y = "Tasa de Mortalidad"
) +
theme_minimal(base_size = 14)
})
}
# ---- 5) LANZAR APP ----
shinyApp(ui, server)
